//BugLog 1.0 (https://github.com/islavisual/bugLog). * Copyright 2014 Islavisual. Licensed under MIT (https://github.com/islavisual/bugLog/blob/master/LICENSE). Author: Pablo E. Fern√°ndez (islavisual@gmail.com). Last update: 09/01/2015
document.addEventListener("DOMContentLoaded",function(){bugLog.showMessage(bugLog.messages.parsedPage,"sending"),$(document).ajaxSuccess(function(e,t,o){var a=bugLog.messages.ajaxSuccess.replace("<method>",o.async);a=a.replace("<type>",o.type),a=a.replace("<crossDomain>",o.crossDomain),a=a.replace("<url>",o.url),a=a.replace("<contentType>",o.contentType),bugLog.showMessage(a,"updated")}),$(document).ajaxError(function(e,t){bugLog.showMessage(bugLog.messages.ajaxError+("console"==bugLog.target?"\n":"<br/>")+" Status Error: "+t.status+("console"==bugLog.target?"\n":"<br/>")+"Status Text: "+t.statusText+("console"==bugLog.target?"\n":"<br/>")+"Description: "+t.responseText,"error")}),$(document).ajaxComplete(function(e,t,o){var a=bugLog.messages.ajaxComplete.replace("<url>",o.url);bugLog.showMessage(a,"readyState")}),$.ajaxSetup({beforeSend:function(){var e=bugLog.messages.ajaxBeforeSend.replace("<method>",this.async);e=e.replace("<type>",this.type),e=e.replace("<crossDomain>",this.crossDomain),e=e.replace("<url>",this.url),e=e.replace("<contentType>",this.contentType),bugLog.showMessage(e,"proccessing")}})}),document.onreadystatechange=function(){"interactive"==document.readyState?bugLog.showMessage(bugLog.messages.pageChangedStatus+" "+document.readyState,"proccessing"):bugLog.showMessage(bugLog.messages.pageChangedStatus+" "+document.readyState,"readyState")},window.addEventListener("load",function(){bugLog.showMessage(bugLog.messages.pageChangedStatus+" finished","updated")}),window.onerror=function(e,t,o,a,r){return console.log(r),alert("Error: "+e+"\nScript: "+t+"\nLine: "+o+"\nColumn: "+a),!0};var bugLog={mode:"",target:"",targetWindow:null,mutationObserver:"Not Supported",mutationAttributesFilter:[],mutationNotObserverAttributesFilter:["style"],enableHistory:!1,history:{},enableUndo:!0,undo:{},redo:{},messages:{ajaxBeforeSend:"Processing request. Method: <method>. Type: <type>. CrossDomain: <crossDomain>.  File: <url>. Content Type: <contentType>",ajaxComplete:"The Ajax processing request FINISHED for the <url> file.",ajaxSuccess:"The Ajax request was completed SUCCESSFULLY for the <url> file.",ajaxError:"An error occurred into Ajax processing request into <url> file.",beforeUnloadPage:"Page request unload",unloadPage:"Unloaded page",errorPage:"An error occurred into file",parsedPage:"Page loaded and parsed.",pageChangedStatus:"Page changed status:",valueChanged:"The <selector> changed the value property to <value>.",getsFocus:"<selector> gets focus.",losesFocus:"<selector> loses focus.",click:"User clicks into <selector>.",attributeMutation:'The <attributeName> attribute has mutated from "<oldValue>" to "<value>" into <selector> element.',addedChildren:"Added children into <selector> element. Total children: <totalChildren>",removedChildren:"Removed children into <selector> element. Total children: <totalChildren>",mouseOver:"The mouse pointer is over the <selector> element.",mouseOut:"The mouse pointer leaves the <selector> element.",keyPress:'Keyboard event received into <selector> element. Keys Combination: "<keys>". Keys Combination Code: "<keysCode>".',separator:'<div style="border: 1px solid #333; border-width: 0px 0px 1px 0px; height:5px; width:100%;margin-bottom: 5px;">&nbsp;</div>'},colors:{added:"#709050",attributeChanged:"#ff00ff",background:"#000000",blur:"#907080",focus:"#9070a0",click:"#909090",mouseOver:"#a07090",mouseOut:"#807090",keyPress:"#80a090",error:"#a02020",headerForeground:"#ffffff",headerBackground:"#333",normal:"#606060",proccessing:"#8AC007",readyState:"#8AC007",removed:"#a01010",sending:"#8AC007",updated:"#80a0e0",valueChanged:"#FE2466"},version:"1.0",init:function(e,t){this.getMode(e),this.getTarget(t);var o={subtree:!0,childList:!1,attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1};if("all"==this.mode)var o={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0};"undefined"!=typeof this.mutationAttributesFilter&&0!=this.mutationAttributesFilter.length&&(o.attributeFilter=this.mutationAttributesFilter);for(var a=["WebKit","Moz","O","Ms",""],r=0;r<a.length;r++)a[r]+"MutationObserver"in window&&(this.mutationObserver=window[a[r]+"MutationObserver"]);this.showMessage("Mutation Observer Functionality: "+this.mutationObserver,"normal");var s=this,n=new this.mutationObserver(function(e){e.forEach(function(e){{var t=e.target.id,o=(e.target.className,e.target.tagName);e.target.ownerDocument.lastModified}try{var a=$(e.target).parentsUntil("html").map(function(){return this.tagName+(""!=this.className?"."+this.className:"")}).get().reverse().join(" > ")}catch(r){var a="NULL"}t="undefined"==typeof t||""==t?o:"#"+t,t=a+" > "+t,"attributes"==e.type&&-1==s.mutationNotObserverAttributesFilter.indexOf(e.attributeName)?(bugLog.showMessage(bugLog.messages.attributeMutation.replace("<attributeName>",e.attributeName).replace("<oldValue>",e.oldValue).replace("<value>",$(e.target).prop(e.attributeName)).replace("<selector>",t),"attributeChanged"),"undefined"!=typeof e.target.id&&""!=e.target.id&&null!=e.target.id&&bugLog.addHistoryBack(e.target.id,$(e.target).prop(e.attributeName))):"childList"==e.type&&(null!=e.addedNodes?bugLog.showMessage(bugLog.messages.addedChildren.replace("<totalChildren>",e.addedNodes.length).replace("<selector>",t),"added"):null!=e.removedNodes&&bugLog.showMessage(bugLog.messages.removedChildren.replace("<totalChildren>",e.removedNodes.length).replace("<selector>",t),"removed"))})});n.observe(document,o);try{bugLog.setUserEvents()}catch(g){window.onload=function(){bugLog.setUserEvents()}}var u=JSON.parse(sessionStorage.getItem("bugLogUndo"));"undefined"!=typeof u&&null!=u&&""!=u&&(bugLog.undo=u)},getMode:function(e){this.mode="undefined"!=typeof e&&"all"==e?"all":"default",this.showMessage("Mode: "+this.mode,"normal")},getTarget:function(e){this.target="undefined"!=typeof e?"console"==e?"console":"window":"console","window"==this.target&&(this.targetWindow=window.open("","bugLogWindow","toolbar=no, scrollbars=yes, resizable=yes, top=0, left=0, width=500, height=500"),this.targetWindow.document.body.innerHTML="",this.targetWindow.document.write("<style>body { background:"+bugLog.colors.background+"; } h2 {background:"+bugLog.colors.headerBackground+"; color:"+bugLog.colors.headerForeground+"; padding:5px;}</style>"),this.targetWindow.document.write("<H2>BugLog 1.0 - Page loaded at "+this.getTime()+"</H2>")),this.showMessage("Target: "+this.target,"normal"),this.showMessage("Target Window: "+this.targetWindow,"normal")},getTime:function(){var e=new Date,t=e.getDay(),o=e.getMonth()+1,a=e.getFullYear(),r=e.getHours(),s=e.getMinutes(),n=e.getSeconds(),g=e.getMilliseconds();return(10>t?"0"+t:t)+"/"+(10>o?"0"+o:o)+"/"+(10>a?"0"+a:a)+" "+(10>r?"0"+r:r)+":"+(10>s?"0"+s:s)+":"+(10>n?"0"+n:n)+"."+g},setUserEvents:function(){$("body *").on("change click focusin focusout mouseenter mouseleave keydown",function(e){e.stopPropagation();var t=e.target.id,o=(e.target.className,e.target.tagName),a=e.type;try{var r=$(e.currentTarget).parentsUntil("html").map(function(){return this.tagName+(""!=this.className?"."+this.className:"")}).get().reverse().join(" > ")}catch(e){var r="NULL"}if(t="undefined"==typeof t||""==t?o:"#"+t,t=r+" > "+t,"change"==a)bugLog.showMessage(bugLog.messages.valueChanged.replace("<selector>",t).replace("<value>",$(e.target).val()),"valueChanged");else if("focusin"==a)bugLog.showMessage(bugLog.messages.getsFocus.replace("<selector>",t),"focus");else if("focusout"==a)bugLog.showMessage(bugLog.messages.losesFocus.replace("<selector>",t),"blur");else if("click"==a)bugLog.showMessage(bugLog.messages.click.replace("<selector>",t),"click");else if("mouseenter"==a&&"all"==this.mode)bugLog.showMessage(bugLog.messages.mouseOver.replace("<selector>",t),"mouseOver");else if("mouseleave"==a&&"all"==this.mode)bugLog.showMessage(bugLog.messages.mouseOut.replace("<selector>",t),"mouseOut");else if("keydown"==a){var s=e.which?e.which:e.keyCode,n="",g="",u="";(e.shiftKey||16==s)&&(g+="Shift + ",u="16 + "),(e.ctrlKey||17==s)&&(g+="Ctrl + ",u="17 + "),(e.altKey||18==s)&&(g+="Alt + ",u="18 + "),n+=8==s?"Backspace":9==s?"Tab":13==s?"Enter":19==s?"Pause / Break":27==s?"Escape":19==s?"Pause / Break":33==s?"Page Up":34==s?"Page Down":35==s?"End":36==s?"Home":37==s?"Left Arrow":38==s?"Up Arrow":39==s?"Right Arrow":40==s?"Down Arrow":45==s?"Insert":46==s?"Delete":91==s?"Left window":92==s?"Right window":93==s?"Select key":96==s?"Numpad 0":97==s?"Numpad 1":98==s?"Numpad 2":99==s?"Numpad 3":100==s?"Numpad 4":101==s?"Numpad 5":102==s?"Numpad 6":103==s?"Numpad 7":104==s?"Numpad 8":105==s?"Numpad 9":106==s?"Multiply":107==s?"Add":109==s?"Subtract":110==s?"Decimal point":111==s?"Divide":112==s?"F1":113==s?"F2":114==s?"F3":115==s?"F4":116==s?"F5":117==s?"F6":118==s?"F7":119==s?"F8":120==s?"F9":121==s?"F10":122==s?"F11":123==s?"F12":144==s?"num lock":145==s?"scroll lock":186==s?"Semi-colon (;)":187==s?"Equal-sign (=)":188==s?"Comma (,)":189==s?"Dash (-)":190==s?"Period (.)":191==s?"Forward Slash (/)":192==s?"Grave Accent(`)":219==s?"Open Bracket ([)":220==s?"Back Slash (\\)":221==s?"Close Bracket (])":222==s?"Single Quote (')":String.fromCharCode(s),s>18&&(bugLog.showMessage(bugLog.messages.keyPress.replace("<selector>",t).replace("<keys>",g+n).replace("<keysCode>",u+s),"keyPress"),"undefined"!=typeof e.target.id&&""!=e.target.id&&null!=e.target.id&&bugLog.addHistoryBack(e.target.id,$(e.target).val()))}})},addHistoryBack:function(e,t){if(bugLog.enableUndo){var o=bugLog.sha1(window.location.pathname);"undefined"==typeof bugLog.undo[o]&&(bugLog.undo[o]={});try{bugLog.undo[o][e][bugLog.undo[o][e].length-1]!=t&&(bugLog.undo[o][e][bugLog.undo[o][e].length]=t)}catch(a){bugLog.undo[o][e]=new Array,bugLog.undo[o][e][0]=t}sessionStorage.setItem("bugLogUndo",JSON.stringify(bugLog.undo))}},historyBack:function(e){if(bugLog.enableUndo)try{var t=bugLog.sha1(window.location.pathname),o=bugLog.undo[t][e].pop();if($("#"+e).val()==o)var o=bugLog.undo[t][e].pop();return"undefined"!=typeof o&&null!=o&&""!=o?(0==bugLog.undo[t][e].length&&delete bugLog.undo[t][e],sessionStorage.setItem("bugLogUndo",JSON.stringify(bugLog.undo)),bugLog.addHistoryForward(e,$("#"+e).val()),$("#"+e).val(o),o):null}catch(a){}},addHistoryForward:function(e,t){if(bugLog.enableUndo){var o=bugLog.sha1(window.location.pathname);"undefined"==typeof bugLog.redo[o]&&(bugLog.redo[o]={});try{bugLog.redo[o][e][bugLog.redo[o][e].length-1]!=t&&(bugLog.redo[o][e][bugLog.redo[o][e].length]=t)}catch(a){bugLog.redo[o][e]=new Array,bugLog.redo[o][e][0]=t}sessionStorage.setItem("bugLogRedo",JSON.stringify(bugLog.redo))}},historyForward:function(e){if(bugLog.enableUndo)try{var t=bugLog.sha1(window.location.pathname),o=bugLog.redo[t][e].pop();if($("#"+e).val()==o)var o=bugLog.undo[t][e].pop();return"undefined"!=typeof o&&null!=o&&""!=o?(0==bugLog.redo[t][e].length&&delete bugLog.redo[t][e],sessionStorage.setItem("bugLogRedo",JSON.stringify(bugLog.redo)),bugLog.addHistoryBack(e,$("#"+e).val()),$("#"+e).val(o),o):null}catch(a){}},getHistory:function(){var e=bugLog.sha1(window.location.pathname);return bugLog.history[e]},sha1:function(e){var t,o,a,r,s,n,g,u,i,d=function(e,t){var o=e<<t|e>>>32-t;return o},l=function(e){var t,o,a="";for(t=7;t>=0;t--)o=e>>>4*t&15,a+=o.toString(16);return a},c=new Array(80),h=1732584193,b=4023233417,m=2562383102,p=271733878,f=3285377520,L=e.length,y=[];for(o=0;L-3>o;o+=4)a=e.charCodeAt(o)<<24|e.charCodeAt(o+1)<<16|e.charCodeAt(o+2)<<8|e.charCodeAt(o+3),y.push(a);switch(L%4){case 0:o=2147483648;break;case 1:o=e.charCodeAt(L-1)<<24|8388608;break;case 2:o=e.charCodeAt(L-2)<<24|e.charCodeAt(L-1)<<16|32768;break;case 3:o=e.charCodeAt(L-3)<<24|e.charCodeAt(L-2)<<16|e.charCodeAt(L-1)<<8|128}for(y.push(o);y.length%16!=14;)y.push(0);for(y.push(L>>>29),y.push(L<<3&4294967295),t=0;t<y.length;t+=16){for(o=0;16>o;o++)c[o]=y[t+o];for(o=16;79>=o;o++)c[o]=d(c[o-3]^c[o-8]^c[o-14]^c[o-16],1);for(r=h,s=b,n=m,g=p,u=f,o=0;19>=o;o++)i=d(r,5)+(s&n|~s&g)+u+c[o]+1518500249&4294967295,u=g,g=n,n=d(s,30),s=r,r=i;for(o=20;39>=o;o++)i=d(r,5)+(s^n^g)+u+c[o]+1859775393&4294967295,u=g,g=n,n=d(s,30),s=r,r=i;for(o=40;59>=o;o++)i=d(r,5)+(s&n|s&g|n&g)+u+c[o]+2400959708&4294967295,u=g,g=n,n=d(s,30),s=r,r=i;for(o=60;79>=o;o++)i=d(r,5)+(s^n^g)+u+c[o]+3395469782&4294967295,u=g,g=n,n=d(s,30),s=r,r=i;h=h+r&4294967295,b=b+s&4294967295,m=m+n&4294967295,p=p+g&4294967295,f=f+u&4294967295}return i=l(h)+l(b)+l(m)+l(p)+l(f),i.toLowerCase()},showMessage:function(e,t){function o(e){var t="";if("object"==typeof e)for(var r in e){var s=!1;try{s=1==Array.isArray(r)||parseFloat(r)>=0?!0:!1}catch(n){s=!1}"string"!=typeof e[r]||-1==e[r].indexOf("<pre>")&&-1==e[r].indexOf("</pre>")?(t+='<b style="color:'+bugLog.colors.headerForeground+'">'+(0==a?1==s?r+" => [ ":r+" : ":"")+"</b>",a=!1,t+=o(e[r])+(0==a&&1==s?" ] ":"")+("console"==bugLog.target?"\n":"<br/>")):(t+=e[r],a=!0)}else t+=e,a=!1;if(bugLog.enableHistory){var g=bugLog.sha1(window.location.pathname);"undefined"==typeof bugLog.history[g]&&(bugLog.history[g]="BugLog "+bugLog.version+" - Page loaded at "+bugLog.getTime()+"\n---------------------------------------------------\n"),bugLog.history[g]+="["+bugLog.getTime()+"]"+t+"\n"}return t}var a=!1,r="";if(r="undefined"==typeof t?bugLog.colors.normal:bugLog.colors[t],"console"==this.target||""==this.target){var s="["+this.getTime()+"] "+o(e);"error"==t?console.error(s):"warn"==t?console.warn(s):"info"==t?console.info(s):console.log(s)}else{var s="<span style='color:"+bugLog.colors.normal+"'>["+this.getTime()+"]</span> ";s+='<span style="color:'+r+'">'+o(e)+"</span>";try{this.targetWindow.document.write(s+bugLog.messages.separator)}catch(n){}}}};
