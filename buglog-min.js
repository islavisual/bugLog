//BugLog 1.0 (https://github.com/islavisual/bugLog). * Copyright 2014 Islavisual. Licensed under MIT (https://github.com/islavisual/bugLog/blob/master/LICENSE). Author: Pablo E. Fern√°ndez (islavisual@gmail.com). Last update: 09/01/2015
document.addEventListener("DOMContentLoaded",function(a){bugLog.showMessage(bugLog.messages.parsedPage,"sending");$(document).ajaxSuccess(function(b,e,d){var c=bugLog.messages.ajaxSuccess.replace("<method>",d.async);c=c.replace("<type>",d.type);c=c.replace("<crossDomain>",d.crossDomain);c=c.replace("<url>",d.url);c=c.replace("<contentType>",d.contentType);bugLog.showMessage(c,"updated")});$(document).ajaxError(function(b,e,c,d){bugLog.showMessage(bugLog.messages.ajaxError+(bugLog.target=="console"?"\n":"<br/>")+" Status Error: "+e.status+(bugLog.target=="console"?"\n":"<br/>")+"Status Text: "+e.statusText+(bugLog.target=="console"?"\n":"<br/>")+"Description: "+e.responseText,"error")});$(document).ajaxComplete(function(b,e,d){var c=bugLog.messages.ajaxComplete.replace("<url>",d.url);bugLog.showMessage(c,"readyState")});$.ajaxSetup({beforeSend:function(){var b=bugLog.messages.ajaxBeforeSend.replace("<method>",this.async);b=b.replace("<type>",this.type);b=b.replace("<crossDomain>",this.crossDomain);b=b.replace("<url>",this.url);b=b.replace("<contentType>",this.contentType);bugLog.showMessage(b,"proccessing")}})});document.onreadystatechange=function(){if(document.readyState=="interactive"){bugLog.showMessage(bugLog.messages.pageChangedStatus+" "+document.readyState,"proccessing")}else{bugLog.showMessage(bugLog.messages.pageChangedStatus+" "+document.readyState,"readyState")}};window.addEventListener("load",function(){bugLog.showMessage(bugLog.messages.pageChangedStatus+" finished","updated")});window.onerror=function(e,b,a,d,c){console.log(c);alert("Error: "+e+"\nScript: "+b+"\nLine: "+a+"\nColumn: "+d);return true};var bugLog={mode:"",target:"",targetWindow:null,mutationObserver:"Not Supported",mutationAttributesFilter:[],mutationNotObserverAttributesFilter:["style"],enableHistory:false,history:{},enableUndo:true,undo:{},redo:{},messages:{ajaxBeforeSend:"Processing request. Method: <method>. Type: <type>. CrossDomain: <crossDomain>.  File: <url>. Content Type: <contentType>",ajaxComplete:"The Ajax processing request FINISHED for the <url> file.",ajaxSuccess:"The Ajax request was completed SUCCESSFULLY for the <url> file.",ajaxError:"An error occurred into Ajax processing request into <url> file.",beforeUnloadPage:"Page request unload",unloadPage:"Unloaded page",errorPage:"An error occurred into file",parsedPage:"Page loaded and parsed.",pageChangedStatus:"Page changed status:",valueChanged:"The <selector> changed the value property to <value>.",getsFocus:"<selector> gets focus.",losesFocus:"<selector> loses focus.",click:"User clicks into <selector>.",attributeMutation:'The <attributeName> attribute has mutated from "<oldValue>" to "<value>" into <selector> element.',addedChildren:"Added children into <selector> element. Total children: <totalChildren>",removedChildren:"Removed children into <selector> element. Total children: <totalChildren>",mouseOver:"The mouse pointer is over the <selector> element.",mouseOut:"The mouse pointer leaves the <selector> element.",keyPress:'Keyboard event received into <selector> element. Keys Combination: "<keys>". Keys Combination Code: "<keysCode>".',separator:'<div style="border: 1px solid #333; border-width: 0px 0px 1px 0px; height:5px; width:100%;margin-bottom: 5px;">&nbsp;</div>'},colors:{added:"#709050",attributeChanged:"#ff00ff",background:"#000000",blur:"#907080",focus:"#9070a0",click:"#909090",mouseOver:"#a07090",mouseOut:"#807090",keyPress:"#80a090",error:"#a02020",headerForeground:"#ffffff",headerBackground:"#333",normal:"#606060",proccessing:"#8AC007",readyState:"#8AC007",removed:"#a01010",sending:"#8AC007",updated:"#80a0e0",valueChanged:"#FE2466"},version:"1.0",init:function(c,d){this.getMode(c);this.getTarget(d);var g={subtree:true,childList:false,attributes:true,attributeOldValue:false,characterData:true,characterDataOldValue:false};if(this.mode=="all"){var g={subtree:true,childList:true,attributes:true,attributeOldValue:true,characterData:true,characterDataOldValue:true}}if(typeof this.mutationAttributesFilter!="undefined"&&this.mutationAttributesFilter.length!=0){g.attributeFilter=this.mutationAttributesFilter}var a=["WebKit","Moz","O","Ms",""];for(var b=0;b<a.length;b++){if(a[b]+"MutationObserver" in window){this.mutationObserver=window[a[b]+"MutationObserver"]}}this.showMessage("Mutation Observer Functionality: "+this.mutationObserver,"normal");var k=this;var h=new this.mutationObserver(function(e){e.forEach(function(l){var q=l.target.id;var o=l.target.className;var n=l.target.tagName;var i=l.target.ownerDocument.lastModified;try{var m=$(l.target).parentsUntil("html").map(function(){return this.tagName+(this.className!=""?("."+this.className):"")}).get().reverse().join(" > ")}catch(p){var m="NULL"}if(typeof q=="undefined"||q==""){q=n}else{q="#"+q}q=m+" > "+q;if(l.type=="attributes"&&k.mutationNotObserverAttributesFilter.indexOf(l.attributeName)==-1){bugLog.showMessage(bugLog.messages.attributeMutation.replace("<attributeName>",l.attributeName).replace("<oldValue>",l.oldValue).replace("<value>",$(l.target).prop(l.attributeName)).replace("<selector>",q),"attributeChanged");if(typeof l.target.id!="undefined"&&l.target.id!=""&&l.target.id!=null){bugLog.addHistoryBack(l.target.id,$(l.target).prop(l.attributeName))}}else{if(l.type=="childList"){if(l.addedNodes!=null){bugLog.showMessage(bugLog.messages.addedChildren.replace("<totalChildren>",l.addedNodes.length).replace("<selector>",q),"added")}else{if(l.removedNodes!=null){bugLog.showMessage(bugLog.messages.removedChildren.replace("<totalChildren>",l.removedNodes.length).replace("<selector>",q),"removed")}}}}})});h.observe(document,g);try{bugLog.setUserEvents()}catch(f){window.onload=function(){bugLog.setUserEvents()}}var j=JSON.parse(sessionStorage.getItem("bugLogUndo"));if(typeof j!="undefined"&&j!=null&&j!=""){bugLog.undo=j}},getMode:function(a){if(typeof a!="undefined"){if(a=="all"){this.mode="all"}else{this.mode="default"}}else{this.mode="default"}this.showMessage("Mode: "+this.mode,"normal")},getTarget:function(a){if(typeof a!="undefined"){if(a=="console"){this.target="console"}else{this.target="window"}}else{this.target="console"}if(this.target=="window"){this.targetWindow=window.open("","bugLogWindow","toolbar=no, scrollbars=yes, resizable=yes, top=0, left=0, width=500, height=500");this.targetWindow.document.body.innerHTML="";this.targetWindow.document.body.style.background=bugLog.colors.background;this.targetWindow.document.write('<H2 style="background:'+bugLog.colors.headerBackground+"; color:"+bugLog.colors.headerForeground+'; padding:5px;">BugLog 1.0 - Page loaded at '+this.getTime()+"</H2>")}this.showMessage("Target: "+this.target,"normal");this.showMessage("Target Window: "+this.targetWindow,"normal")},getTime:function(){var c=new Date();var j=c.getDay(),a=c.getMonth()+1,k=c.getFullYear(),g=c.getHours(),e=c.getMinutes(),f=c.getSeconds(),b=c.getMilliseconds();return(j<10?"0"+j:j)+"/"+(a<10?"0"+a:a)+"/"+(k<10?"0"+k:k)+" "+(g<10?"0"+g:g)+":"+(e<10?"0"+e:e)+":"+(f<10?"0"+f:f)+"."+b},setUserEvents:function(){$("body *").on("change click focusin focusout mouseenter mouseleave keydown",function(h){h.stopPropagation();var b=h.target.id;var a=h.target.className;var f=h.target.tagName;var i=h.type;try{var j=$(h.currentTarget).parentsUntil("html").map(function(){return this.tagName+(this.className!=""?("."+this.className):"")}).get().reverse().join(" > ")}catch(h){var j="NULL"}if(typeof b=="undefined"||b==""){b=f}else{b="#"+b}b=j+" > "+b;if(i=="change"){bugLog.showMessage(bugLog.messages.valueChanged.replace("<selector>",b).replace("<value>",$(h.target).val()),"valueChanged")}else{if(i=="focusin"){bugLog.showMessage(bugLog.messages.getsFocus.replace("<selector>",b),"focus")}else{if(i=="focusout"){bugLog.showMessage(bugLog.messages.losesFocus.replace("<selector>",b),"blur")}else{if(i=="click"){bugLog.showMessage(bugLog.messages.click.replace("<selector>",b),"click")}else{if(i=="mouseenter"&&this.mode=="all"){bugLog.showMessage(bugLog.messages.mouseOver.replace("<selector>",b),"mouseOver")}else{if(i=="mouseleave"&&this.mode=="all"){bugLog.showMessage(bugLog.messages.mouseOut.replace("<selector>",b),"mouseOut")}else{if(i=="keydown"){var k=(h.which)?h.which:h.keyCode;var g="",d="",c="";if(h.shiftKey||k==16){d+="Shift + ";c="16 + "}if(h.ctrlKey||k==17){d+="Ctrl + ";c="17 + "}if(h.altKey||k==18){d+="Alt + ";c="18 + "}if(k==8){g+="Backspace"}else{if(k==9){g+="Tab"}else{if(k==13){g+="Enter"}else{if(k==19){g+="Pause / Break"}else{if(k==27){g+="Escape"}else{if(k==19){g+="Pause / Break"}else{if(k==33){g+="Page Up"}else{if(k==34){g+="Page Down"}else{if(k==35){g+="End"}else{if(k==36){g+="Home"}else{if(k==37){g+="Left Arrow"}else{if(k==38){g+="Up Arrow"}else{if(k==39){g+="Right Arrow"}else{if(k==40){g+="Down Arrow"}else{if(k==45){g+="Insert"}else{if(k==46){g+="Delete"}else{if(k==91){g+="Left window"}else{if(k==92){g+="Right window"}else{if(k==93){g+="Select key"}else{if(k==96){g+="Numpad 0"}else{if(k==97){g+="Numpad 1"}else{if(k==98){g+="Numpad 2"}else{if(k==99){g+="Numpad 3"}else{if(k==100){g+="Numpad 4"}else{if(k==101){g+="Numpad 5"}else{if(k==102){g+="Numpad 6"}else{if(k==103){g+="Numpad 7"}else{if(k==104){g+="Numpad 8"}else{if(k==105){g+="Numpad 9"}else{if(k==106){g+="Multiply"}else{if(k==107){g+="Add"}else{if(k==109){g+="Subtract"}else{if(k==110){g+="Decimal point"}else{if(k==111){g+="Divide"}else{if(k==112){g+="F1"}else{if(k==113){g+="F2"}else{if(k==114){g+="F3"}else{if(k==115){g+="F4"}else{if(k==116){g+="F5"}else{if(k==117){g+="F6"}else{if(k==118){g+="F7"}else{if(k==119){g+="F8"}else{if(k==120){g+="F9"}else{if(k==121){g+="F10"}else{if(k==122){g+="F11"}else{if(k==123){g+="F12"}else{if(k==144){g+="num lock"}else{if(k==145){g+="scroll lock"}else{if(k==186){g+="Semi-colon (;)"}else{if(k==187){g+="Equal-sign (=)"}else{if(k==188){g+="Comma (,)"}else{if(k==189){g+="Dash (-)"}else{if(k==190){g+="Period (.)"}else{if(k==191){g+="Forward Slash (/)"}else{if(k==192){g+="Grave Accent(`)"}else{if(k==219){g+="Open Bracket ([)"}else{if(k==220){g+="Back Slash (\\)"}else{if(k==221){g+="Close Bracket (])"}else{if(k==222){g+="Single Quote (')"}else{g+=String.fromCharCode(k)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(k>18){bugLog.showMessage(bugLog.messages.keyPress.replace("<selector>",b).replace("<keys>",d+g).replace("<keysCode>",c+k),"keyPress");if(typeof h.target.id!="undefined"&&h.target.id!=""&&h.target.id!=null){bugLog.addHistoryBack(h.target.id,$(h.target).val())}}}}}}}}}})},addHistoryBack:function(d,a){if(bugLog.enableUndo){var c=bugLog.sha1(window.location.pathname);if(typeof bugLog.undo[c]=="undefined"){bugLog.undo[c]={}}try{if(bugLog.undo[c][d][bugLog.undo[c][d].length-1]!=a){bugLog.undo[c][d][bugLog.undo[c][d].length]=a}}catch(b){bugLog.undo[c][d]=new Array();bugLog.undo[c][d][0]=a}sessionStorage.setItem("bugLogUndo",JSON.stringify(bugLog.undo))}},historyBack:function(d){if(bugLog.enableUndo){try{var c=bugLog.sha1(window.location.pathname);var a=bugLog.undo[c][d].pop();if($("#"+d).val()==a){var a=bugLog.undo[c][d].pop()}if(typeof a!=="undefined"&&a!=null&&a!=""){if(bugLog.undo[c][d].length==0){delete bugLog.undo[c][d]}sessionStorage.setItem("bugLogUndo",JSON.stringify(bugLog.undo));bugLog.addHistoryForward(d,$("#"+d).val());$("#"+d).val(a);return a}return null}catch(b){}}},addHistoryForward:function(d,a){if(bugLog.enableUndo){var c=bugLog.sha1(window.location.pathname);if(typeof bugLog.redo[c]=="undefined"){bugLog.redo[c]={}}try{if(bugLog.redo[c][d][bugLog.redo[c][d].length-1]!=a){bugLog.redo[c][d][bugLog.redo[c][d].length]=a}}catch(b){bugLog.redo[c][d]=new Array();bugLog.redo[c][d][0]=a}sessionStorage.setItem("bugLogRedo",JSON.stringify(bugLog.redo))}},historyForward:function(d){if(bugLog.enableUndo){try{var c=bugLog.sha1(window.location.pathname);var a=bugLog.redo[c][d].pop();if($("#"+d).val()==a){var a=bugLog.undo[c][d].pop()}if(typeof a!="undefined"&&a!=null&&a!=""){if(bugLog.redo[c][d].length==0){delete bugLog.redo[c][d]}sessionStorage.setItem("bugLogRedo",JSON.stringify(bugLog.redo));bugLog.addHistoryBack(d,$("#"+d).val());$("#"+d).val(a);return a}return null}catch(b){}}},getHistory:function(){var a=bugLog.sha1(window.location.pathname);return bugLog.history[a]},sha1:function(r){var c=function(j,i){var w=j<<i|j>>>32-i;return w};var s=function(w){var i="";var x;var j;for(x=7;x>=0;x--){j=w>>>x*4&15;i+=j.toString(16)}return i};var f,u,t,b=new Array(80),l=1732584193,h=4023233417,g=2562383102,e=271733878,d=3285377520,q,p,o,n,m,v,a=r.length,k=[];for(u=0;u<a-3;u+=4){t=r.charCodeAt(u)<<24|r.charCodeAt(u+1)<<16|r.charCodeAt(u+2)<<8|r.charCodeAt(u+3);k.push(t)}switch(a%4){case 0:u=2147483648;break;case 1:u=r.charCodeAt(a-1)<<24|8388608;break;case 2:u=r.charCodeAt(a-2)<<24|r.charCodeAt(a-1)<<16|32768;break;case 3:u=r.charCodeAt(a-3)<<24|r.charCodeAt(a-2)<<16|r.charCodeAt(a-1)<<8|128;break}k.push(u);while(k.length%16!=14){k.push(0)}k.push(a>>>29);k.push(a<<3&4294967295);for(f=0;f<k.length;f+=16){for(u=0;u<16;u++){b[u]=k[f+u]}for(u=16;u<=79;u++){b[u]=c(b[u-3]^b[u-8]^b[u-14]^b[u-16],1)}q=l;p=h;o=g;n=e;m=d;for(u=0;u<=19;u++){v=c(q,5)+(p&o|~p&n)+m+b[u]+1518500249&4294967295;m=n;n=o;o=c(p,30);p=q;q=v}for(u=20;u<=39;u++){v=c(q,5)+(p^o^n)+m+b[u]+1859775393&4294967295;m=n;n=o;o=c(p,30);p=q;q=v}for(u=40;u<=59;u++){v=c(q,5)+(p&o|p&n|o&n)+m+b[u]+2400959708&4294967295;m=n;n=o;o=c(p,30);p=q;q=v}for(u=60;u<=79;u++){v=c(q,5)+(p^o^n)+m+b[u]+3395469782&4294967295;m=n;n=o;o=c(p,30);p=q;q=v}l=l+q&4294967295;h=h+p&4294967295;g=g+o&4294967295;e=e+n&4294967295;d=d+m&4294967295}v=s(l)+s(h)+s(g)+s(e)+s(d);return v.toLowerCase()},showMessage:function(f,d){var c=false;function a(l){var j="";if(typeof(l)=="object"){for(var i in l){var k=false;try{k=(Array.isArray(i)==true||parseFloat(i)>=0)?true:false}catch(n){k=false}if(typeof l[i]=="string"&&(l[i].indexOf("<pre>")!=-1||l[i].indexOf("</pre>")!=-1)){j+=l[i];c=true}else{j+='<b style="color:'+bugLog.colors.headerForeground+'">'+(c==false?(k==true?(i+" => [ "):(i+" : ")):"")+"</b>";c=false;j+=a(l[i])+(c==false?(k==true?" ] ":""):"")+(bugLog.target=="console"?"\n":"<br/>")}}}else{j+=l;c=false}if(bugLog.enableHistory){var m=bugLog.sha1(window.location.pathname);if(typeof bugLog.history[m]=="undefined"){bugLog.history[m]="BugLog "+bugLog.version+" - Page loaded at "+bugLog.getTime()+"\n---------------------------------------------------\n"}bugLog.history[m]+="["+bugLog.getTime()+"]"+j+"\n"}return j}var b="";if(typeof d=="undefined"){b=bugLog.colors.normal}else{b=bugLog.colors[d]}if(this.target=="console"||this.target==""){var h="["+this.getTime()+"] "+a(f);if(d=="error"){console.error(h)}else{if(d=="warn"){console.warn(h)}else{if(d=="info"){console.info(h)}else{console.log(h)}}}}else{var h="<span style='color:"+bugLog.colors.normal+"'>["+this.getTime()+"]</span> ";h+='<span style="color:'+b+'">'+a(f)+"</span>";try{this.targetWindow.document.write(h+bugLog.messages.separator)}catch(g){}}}};